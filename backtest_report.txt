# 回测一致性验证报告

## 1. 验证概述
本次验证旨在确认交易回测系统的逻辑一致性，涵盖图表买卖点、交易明细、统计汇总及收益率曲线。
测试标的：贵州茅台 (600519)
测试周期：1年 (2024-01-01 至 2025-01-01)
测试参数：初始资金 100,000 元，开仓手数 20 手 (2000股)

## 2. 数据源与环境
- 数据源：Eastmoney (主)，Sina Minute Resample (备用)
- 验证脚本：verify_backtest_new.py
- 执行结果：通过 (Consistency Check PASSED)

## 3. 一致性检查结果

### a) 图表买卖点与交易明细
- 验证：每一笔图表上的买卖信号均对应交易明细表中的一条记录。
- 结果：完全匹配。

### b) 统计汇总与明细计算
- 统计总盈亏 (权益法): -990,660.50 元
- 明细总盈亏 (现金法): -992,660.50 元
- 差异: 2,000.00 元
- 差异原因：期末持仓浮动盈亏 (Floating P&L)。
- 详细分析：
  - 期末持仓方向: -1 (空头)
  - 持仓数量: 2000 股
  - 浮动盈亏计算: (建仓价 - 当前价) * 数量 = 2000.00 元
  - 结论：差异完全由浮动盈亏解释，系统逻辑严密一致。

### c) 收益率曲线与累计盈亏
- 验证：收益率曲线的终值与统计总盈亏一致。
- 结果：一致。

### d) 参数修改验证
- 验证：修改初始资金和手数后，盈亏金额和收益率按比例更新。
- 结果：通过。

## 4. 异常交易记录分析
- **资金不足风险**: 测试中使用 10万元 资金交易 20手 茅台 (市值约 300万元+)，导致巨额负债 (-990%)。
- **建议**:
  - 用户应根据标的价格合理设置手数。
  - 系统已支持 1-1000 手的灵活配置，建议茅台类高价股使用 1 手进行测试。

## 5. 功能更新说明
1. **中文标识**: 图表已更新为 "买入" (红) / "卖出" (绿)。
2. **参数配置**: 前端已增加资金和手数输入框。
3. **明细完善**: 交易明细表新增手续费、单笔盈亏列。
4. **数据容错**: 后端增加数据源自动切换功能，解决接口不稳定问题。
